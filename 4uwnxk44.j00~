using EasyTabs;
using Microsoft.Win32;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Drawing.Text;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using Win32Interop.Structs;
using CefSharp;
using CefSharp.WinForms;
using Microsoft.Web.WebView2.Core;

namespace Surf
{
    public partial class Form1 : Form
    {
        private static bool darkMode = false;
        private static bool fullScreen = false;
        private static bool hideSide = false;
        private static bool isFavorite = false;

       AppContainer container = new AppContainer();

        public Form1()
        {
            InitializeComponent();

            if (darkMode)
            {
                mainBar.BackColor = Color.FromArgb(0, 0, 0);
                SearchBar.BackColor = Color.FromArgb(10, 10, 10);
                SearchBar.ForeColor = Color.FromArgb(255, 255, 255);
                SideBar.BackColor = Color.FromArgb(0, 0, 0);
                LDButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\D Mode Icon.png");
                BackButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\BackIcon(D-Mode).png");
                ForwardButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\ForwardIcon(D-Mode).png");
                ReloadButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\ReloadIcon(D-Mode).png");
                HistoryButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\HistoryIcon(D-Mode).png");
                DockButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\MoveIcon(D-Mode).png");
                DownloadsButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\DownloadIcon(D-Mode).png");
                VisibilityButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\FullIcon(D-Mode).png");
                FullScreenButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\FullScreen(D-Mode).png");
                HomeButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\HomeIcon(D-Mode).png");
                Surf.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\SurfLogo(D-Mode).png");
                seeFavorites.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\FavoritesIcon(D-Mode).png");
                darkMode = true;
            }

            if (fullScreen) {
                SideBar.Visible = false;
                mainBar.Visible = false;
                ExitFullscreenButton.Visible = true;
            }

            if (hideSide) {
                SideBar.Visible = false;
                ShowSideButton.Visible = true;
            }

            // Start on google
            webView.Source = new Uri("https://google.com");
        }

        protected TitleBarTabs ParentTabs
        {
            get {
                return (ParentForm as TitleBarTabs);
            }
        }

        

        private void Form1_Load(object sender, EventArgs e)
        {

        }

        private void SearchBar_Search(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter && SearchBar.Text != "")
            {
                if (SearchBar.Text.Contains("http://") || SearchBar.Text.Contains("https://") || SearchBar.Text.Contains("edge://"))
                {
                    webView.Source = new Uri(SearchBar.Text);
                    SearchBar.Text = webView.Source.ToString();
                } 
                else if (SearchBar.Text.Contains(".com") || SearchBar.Text.Contains(".net") || SearchBar.Text.Contains(".org") || SearchBar.Text.Contains(".io") || SearchBar.Text.Contains(".co"))
                { 
                    webView.Source = new Uri("https://" + SearchBar.Text);
                    SearchBar.Text = webView.Source.ToString();
                } 
                else
                {
                    if (SearchBar.Text.Contains("!Y") || SearchBar.Text.Contains("!y"))
                    {

                        webView.Source = new Uri("https://www.youtube.com/results?search_query=" + SearchBar.Text);
                        SearchBar.Text = webView.Source.ToString();

                    }
                    else 
                    { 
                        webView.Source = new Uri("https://google.com/search?q=" + SearchBar.Text);
                        SearchBar.Text = webView.Source.ToString();
                    }  
                    
                }
            }
        }

        private void Form1_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.Control && e.KeyCode == Keys.H) {
                webView.Source = new Uri("https://myactivity.google.com/product/search?utm_source=web_search&utm_medium=mavatar&hl=en");
            }
        }

        private void HomeButton_Click(object sender, EventArgs e)
        {
            webView.Source = new Uri("https://google.com");
        }

        private void BackButton_Click(object sender, EventArgs e)
        {
            if (webView.CanGoBack) {
                webView.GoBack();
            }
        }

        private void ForwardButton_Click(object sender, EventArgs e)
        {
            if (webView.CanGoForward) {
                webView.GoForward();
            }
        }

        private void ReloadButton_Click(object sender, EventArgs e)
        {
            webView.Reload();
        }

        private void DownloadsButton_Click(object sender, EventArgs e)
        {
            webView.Source = new Uri("edge://downloads/");
        }

        private void webView_NavigationCompleted(object sender, Microsoft.Web.WebView2.Core.CoreWebView2NavigationCompletedEventArgs e)
        {
            SearchBar.Text = webView.Source.ToString();

            if (darkMode) {
                ReloadButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\ReloadIcon(D-Mode).png");
            }
            else {
                ReloadButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\ReloadIcon.png");
            }

            string title = webView.CoreWebView2.DocumentTitle;

            if (string.IsNullOrWhiteSpace(title))
            {
                this.Text = "New Tab";
            }
            else { 
                this.Text = title;
            }

            if (webView.Source.ToString().Contains("https") || webView.Source.ToString().Contains("edge://"))
            {
                if (!darkMode)
                    SecureImage.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\SecureIcon.png");
                else
                    SecureImage.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\SecureIcon(D-Mode).png");
            }
            else if (webView.Source.ToString().Contains("http")) { 
                if (!darkMode)
                    SecureImage.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\InsecureIcon.png");
                else
                    SecureImage.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\InsecureIcon(D-Mode).png");
            }
        }

        private void SearchBar_DoubleClick(object sender, EventArgs e)
        {
            SearchBar.SelectAll();
        }

        private void HistoryButton_Click(object sender, EventArgs e)
        {
            
            webView.Source = new Uri(" edge://history/");
        }

        private void LDButton_Click(object sender, EventArgs e)
        {
            if (!darkMode)
            {
                mainBar.BackColor = Color.FromArgb(0, 0, 0);
                SearchBar.BackColor = Color.FromArgb(10, 10, 10);
                SearchBar.ForeColor = Color.FromArgb(255, 255, 255);
                SideBar.BackColor = Color.FromArgb(0, 0, 0);
                LDButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\D Mode Icon.png");
                BackButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\BackIcon(D-Mode).png");
                ForwardButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\ForwardIcon(D-Mode).png");
                ReloadButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\ReloadIcon(D-Mode).png");
                HistoryButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\HistoryIcon(D-Mode).png");
                DockButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\MoveIcon(D-Mode).png");
                DownloadsButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\DownloadIcon(D-Mode).png");
                VisibilityButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\FullIcon(D-Mode).png"); 
                FullScreenButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\FullScreen(D-Mode).png");
                HomeButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\HomeIcon(D-Mode).png");
                Surf.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\SurfLogo(D-Mode).png");
                seeFavorites.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\FavoritesIcon(D-Mode).png");
                darkMode = true;
            }
            else
            {
                mainBar.BackColor = Color.FromArgb(255, 255, 255);
                SearchBar.BackColor = Color.FromArgb(245, 245, 245);
                SearchBar.ForeColor = Color.FromArgb(0, 0, 0);
                SideBar.BackColor = Color.FromArgb(255, 255, 255);
                LDButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\L Mode Icon.png");
                BackButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\BackIcon.png");
                ForwardButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\ForwardIcon.png");
                ReloadButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\ReloadIcon.png");
                HistoryButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\HistoryIcon.png");
                DockButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\MoveIcon.png");
                VisibilityButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\FullIcon.png");
                FullScreenButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\FullScreen.png");
                DownloadsButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\DownloadIcon.png");
                HomeButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\HomeIcon.png");
                Surf.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\SurfLogo.png");
                seeFavorites.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\FavoritesIcon.png");
                darkMode = false;
            }
            if (webView.Source.ToString().Contains("https") || webView.Source.ToString().Contains("edge://"))
            {
                if (!darkMode)
                    SecureImage.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\SecureIcon.png");
                else
                    SecureImage.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\SecureIcon(D-Mode).png");
            }
            else if (webView.Source.ToString().Contains("http"))
            {
                if (!darkMode)
                    SecureImage.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\InsecureIcon.png");
                else
                    SecureImage.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\InsecureIcon(D-Mode).png");
            }
        }

        private void DockButton_Click(object sender, EventArgs e)
        {
            switch (SideBar.Dock)
            {
                case DockStyle.Left:
                    SideBar.Dock = DockStyle.Bottom;
                    SideBar.Visible = true;
                    break;
                case DockStyle.Bottom:
                    SideBar.Dock = DockStyle.Right;
                    SideBar.Visible = true;
                    break;
                case DockStyle.Right:
                    SideBar.Dock = DockStyle.Top;
                    SideBar.Visible = true;
                    break;
                default:
                    SideBar.Dock = DockStyle.Left;
                    SideBar.Visible = true;
                    break;
            }
        }

        private void VisibilityButton_Click(object sender, EventArgs e)
        {
            
            SideBar.Visible = false;
            ShowSideButton.Visible = true;
            hideSide = true;
            
        }

        private void ShowSideButton_Click(object sender, EventArgs e)
        {
            SideBar.Visible = true;
            ShowSideButton.Visible = false;
            hideSide = false;
        }

        private void webView_NavigationStarting(object sender, Microsoft.Web.WebView2.Core.CoreWebView2NavigationStartingEventArgs e)
        {
            
            ReloadButton.Image = Image.FromFile("C:\\Users\\monst\\source\\repos\\Surf\\assets\\ReloadAni.gif");
            string title = webView.CoreWebView2.DocumentTitle;

            if (string.IsNullOrWhiteSpace(title))
            {
                this.Text = "New Tab";
            }
            else
            {
                this.Text = title;
            }
        }

        private void FullScreenButton_Click(object sender, EventArgs e)
        {
            SideBar.Visible = false;
            mainBar.Visible = false;
            ExitFullscreenButton.Visible = true;
            fullScreen = true;
        }

        private void ExitFullscreenButton_Click(object sender, EventArgs e)
        {
            SideBar.Visible = true;
            mainBar.Visible = true;
            ExitFullscreenButton.Visible = false;
            fullScreen = false;
        }

        private void StarButton_Click(object sender, EventArgs e)
        {
            
        }


    }
}
